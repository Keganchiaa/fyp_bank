<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Admin Dashboard</title>
    <link rel="stylesheet" href="/css/style.css">
</head>

<body>
    <nav
        style="background: #f0f0f0; padding: 10px; display: flex; justify-content: space-between; align-items: center;">
        <div>
            <a href="/admin/dashboard">Dashboard</a> |
            <a href="/admin/products">Manage Products</a> |
            <a href="/admin/accounts">Account Applications</a> |
            <a href="/admin/creditcards">Credit Card Applications</a>
        </div>

        <div>
            <strong>Welcome, <%= user.username %> (<%= user.role %>)</strong>
        </div>

        <form action="/logout" method="GET" style="margin: 0;">
            <button type="submit">Logout</button>
        </form>
    </nav>

    <!-- âœ… Success / Error Messages -->
    <% if (typeof success !=='undefined' && success) { %>
        <div style="color: green;">
            <%= success %>
        </div>
        <% } %>
            <% if (typeof error !=='undefined' && error) { %>
                <div style="color: red;">
                    <%= error %>
                </div>
                <% } %>

                    <!-- Create Account Section -->
                    <h2>Create New Account</h2>
                    <form action="/admin/create" method="POST" enctype="multipart/form-data">
                        <label>Username:</label>
                        <input type="text" name="username" required>

                        <label>Email:</label>
                        <input type="email" name="userEmail" required>

                        <label>Password:</label>
                        <input type="password" name="userPassword" required>

                        <label>First Name:</label>
                        <input type="text" name="first_name" required>

                        <label>Last Name:</label>
                        <input type="text" name="last_name" required>

                        <label>Alias (optional):</label>
                        <input type="text" name="alias">

                        <label>Date of Birth:</label>
                        <input type="date" name="date_of_birth" required>

                        <label>Phone Number:</label>
                        <input type="text" name="phone_number" required>

                        <label>Country:</label>
                        <input type="text" name="country" required>

                        <label>Address Line 1:</label>
                        <input type="text" name="address_line_1" required>

                        <label>Address Line 2 (optional):</label>
                        <input type="text" name="address_line_2">

                        <label for="postcode">Postal Code:</label>
                        <input type="text" name="postcode" required pattern="\d{6}"
                            title="Postal code must be exactly 6 digits">

                        <label>Profile Image:</label>
                        <input type="file" name="userImage" accept="image/*">

                        <label>Role:</label>
                        <select name="userRole" required>
                            <% if (user.role==='super_admin' ) { %>
                                <option value="admin">Admin</option>
                                <option value="advisor">Advisor</option>
                                <option value="user">Customer</option>
                                <% } else { %>
                                    <option value="user">Customer</option>
                                    <option value="advisor">Advisor</option>
                                    <% } %>
                        </select>

                        <button type="submit">Create Account</button>
                    </form>

                    <hr>

                    <!-- Admin Accounts (super admin only) -->
                    <% if (user.role==='super_admin' ) { %>
                        <h2>Admin Accounts</h2>
                        <table border="1">
                            <tr>
                                <th>Username</th>
                                <th>Email</th>
                                <th>Actions</th>
                            </tr>
                            <% users.filter(u=> u.userRole === 'admin').forEach(admin => { %>
                                <tr>
                                    <td>
                                        <%= admin.username %>
                                    </td>
                                    <td>
                                        <%= admin.userEmail %>
                                    </td>
                                    <td>
                                        <a href="/admin/details/<%= admin.userId %>">Details</a>
                                        <a href="/admin/edit/<%= admin.userId %>">Edit</a>
                                        <a href="/admin/delete/<%= admin.userId %>"
                                            onclick="return confirm('Delete this admin?')">Delete</a>
                                    </td>
                                </tr>
                                <% }); %>
                        </table>
                        <% } %>

                            <h2>Advisor Accounts</h2>
                            <table border="1">
                                <tr>
                                    <th>Username</th>
                                    <th>Email</th>
                                    <th>Actions</th>
                                </tr>
                                <% users.filter(u=> u.userRole === 'advisor').forEach(advisor => { %>
                                    <tr>
                                        <td>
                                            <%= advisor.username %>
                                        </td>
                                        <td>
                                            <%= advisor.userEmail %>
                                        </td>
                                        <td>
                                            <a href="/admin/details/<%= advisor.userId %>">Details</a>
                                            <a href="/admin/edit/<%= advisor.userId %>">Edit</a>
                                            <a href="/admin/delete/<%= advisor.userId %>"
                                                onclick="return confirm('Delete this advisor?')">Delete</a>
                                        </td>
                                    </tr>
                                    <% }); %>
                            </table>

                            <!-- Customer Accounts -->
                            <h2>Customer Accounts</h2>
                            <table border="1">
                                <tr>
                                    <th>Username</th>
                                    <th>Email</th>
                                    <th>Actions</th>
                                </tr>
                                <% users.filter(u=> u.userRole === 'user').forEach(customer => { %>
                                    <tr>
                                        <td>
                                            <%= customer.username %>
                                        </td>
                                        <td>
                                            <%= customer.userEmail %>
                                        </td>
                                        <td>
                                            <a href="/admin/details/<%= customer.userId %>">Details</a>
                                            <a href="/admin/edit/<%= customer.userId %>">Edit</a>
                                            <a href="/admin/delete/<%= customer.userId %>"
                                                onclick="return confirm('Delete this customer?')">Delete</a>
                                        </td>
                                    </tr>
                                    <% }); %>
                            </table>

</body>

</html>