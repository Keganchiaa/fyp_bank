<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Admin - Pending Credit Card Applications</title>
  <link rel="stylesheet" href="/css/style.css" />
</head>
<body>
  <!-- ✅ Admin Navbar -->
  <nav style="background: #f0f0f0; padding: 10px; display: flex; justify-content: space-between; align-items: center;">
    <div>
      <a href="/admin/dashboard">Dashboard</a> |
      <a href="/admin/products">Manage Products</a> |
      <a href="/admin/accounts">Account Applications</a> |
      <a href="/admin/creditcards">Credit Card Applications</a>
    </div>
    <div>
      <strong>Welcome, <%= user.username %> (<%= user.role %>)</strong>
    </div>
    <form action="/logout" method="GET" style="margin: 0;">
      <button type="submit">Logout</button>
    </form>
  </nav>

  <% if (typeof success !== 'undefined' && success) { %>
    <div style="color: green; margin: 10px 0;"><%= success %></div>
  <% } %>
  <% if (typeof error !== 'undefined' && error) { %>
    <div style="color: red; margin: 10px 0;"><%= error %></div>
  <% } %>

  <h1>Pending Credit Card Applications</h1>

  <% if (cards.length === 0) { %>
    <p>No pending credit card applications found.</p>
  <% } else { %>
    <table border="1" cellpadding="8" cellspacing="0">
      <tr>
        <th>User</th>
        <th>Email</th>
        <th>Product</th>
        <th>Card Number</th>
        <th>Expiry Date</th>
        <th>Desired Credit Limit</th>
        <th>KYC Type</th>
        <th>KYC ID Number</th>
        <th>KYC Document</th>
        <th>KYC Status</th>
        <th>Actions</th>
      </tr>
      <% cards.forEach(card => { %>
        <tr>
          <td><%= card.username %></td>
          <td><%= card.userEmail %></td>
          <td><%= card.product_name %></td>
          <td><%= card.card_number %></td>
          <td><%= new Date(card.expiry_date).toISOString().split('T')[0] %></td>
          <td>$<%= parseFloat(card.credit_limit).toFixed(2) %></td>
          <td><%= card.id_type || '—' %></td>
          <td><%= card.id_number || '—' %></td>
          <td>
            <% if (card.document_path) { %>
              <a href="<%= card.document_path %>" target="_blank">View</a>
            <% } else { %>
              —
            <% } %>
          </td>
          <td><%= card.kyc_status || 'pending' %></td>
          <td>
            <!-- Approve Form -->
            <form action="/admin/creditcards/approve/<%= card.card_id %>" method="POST" style="margin-bottom: 5px;">
              <label>Approved Limit:</label>
              <input type="number" name="approved_limit" step="0.01" min="0" value="<%= parseFloat(card.credit_limit).toFixed(2) %>" required>
              <button type="submit">Approve</button>
            </form>
            
            <!-- Reject Form -->
            <form action="/admin/creditcards/reject/<%= card.card_id %>" method="POST" onsubmit="return confirm('Reject this credit card application?');">
              <button type="submit" style="background-color: red; color: white;">Reject</button>
            </form>
          </td>
        </tr>
      <% }) %>
    </table>
  <% } %>

  <br />
  <a href="/admin/dashboard">← Back to Dashboard</a>
</body>
</html>
